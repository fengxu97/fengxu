<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>冯Sir的周计划 - 个人日程管理</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #1e293b;
            --accent-color: #f59e0b;
            --bg-color: #0f172a;
            --card-color: #1e293b;
            --text-color: #f8fafc;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: all 0.3s ease;
        }
        
        .schedule-item {
            background-color: var(--card-color);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            border-left: 4px solid var(--primary-color);
            position: relative;
        }
        
        .schedule-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* 动态类型颜色 - 基于类型名称生成 */
        .schedule-type-custom-1 { border-left-color: #ef4444; }
        .schedule-type-custom-2 { border-left-color: #3b82f6; }
        .schedule-type-custom-3 { border-left-color: #10b981; }
        .schedule-type-custom-4 { border-left-color: #f59e0b; }
        .schedule-type-custom-5 { border-left-color: #8b5cf6; }
        .schedule-type-custom-6 { border-left-color: #ec4899; }
        .schedule-type-custom-7 { border-left-color: #06b6d4; }
        .schedule-type-custom-8 { border-left-color: #84cc16; }
        
        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .status-pending { background-color: #6b7280; color: white; }
        .status-in-progress { background-color: #f59e0b; color: white; }
        .status-completed { background-color: #10b981; color: white; }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: var(--card-color);
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 1100;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .fade-in {
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* 文件导入区域样式 */
        .file-import-area {
            border: 2px dashed #4b5563;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-top: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-import-area:hover {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.05);
        }
        
        .file-import-area.dragover {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        /* 状态筛选按钮样式 */
        .status-filter-btn.active {
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .modal-content {
                width: 95%;
                padding: 15px;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-slate-900 text-slate-100">
    <!-- 导航栏 -->
    <nav class="bg-slate-800 shadow-lg py-4 px-6">
        <div class="container mx-auto">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <i class="fa fa-calendar text-blue-400 text-2xl mr-3"></i>
                    <h1 class="text-xl font-bold">冯Sir的周计划</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="importBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md transition-colors">
                        <i class="fa fa-upload mr-2"></i>导入
                    </button>
                    <button id="exportBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors">
                        <i class="fa fa-download mr-2"></i>导出
                    </button>
                    <button id="addScheduleBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-colors">
                        <i class="fa fa-plus mr-2"></i>添加日程
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主要内容区域 -->
    <div class="container mx-auto py-6 px-4">
        <div class="flex flex-col md:flex-row gap-6">
            <!-- 左侧状态筛选区域 -->
            <div class="w-full md:w-48 flex-shrink-0">
                <div class="bg-slate-800 rounded-lg p-4 shadow-md">
                    <h3 class="text-lg font-semibold mb-4 text-slate-300">状态筛选</h3>
                    <div class="space-y-2">
                        <!-- 状态筛选按钮 - 垂直排列 -->
                        <button class="status-filter-btn active w-full text-left bg-slate-700 text-white px-4 py-3 rounded-md transition-colors" data-status="all">
                            <i class="fa fa-list mr-2"></i>全部状态
                        </button>
                        <button class="status-filter-btn w-full text-left bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-md transition-colors" data-status="pending">
                            <i class="fa fa-clock-o mr-2"></i>未开始
                        </button>
                        <button class="status-filter-btn w-full text-left bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-3 rounded-md transition-colors" data-status="in-progress">
                            <i class="fa fa-spinner mr-2"></i>进行中
                        </button>
                        <button class="status-filter-btn w-full text-left bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-md transition-colors" data-status="completed">
                            <i class="fa fa-check mr-2"></i>已完成
                        </button>
                    </div>
                </div>
            </div>

            <!-- 右侧内容区域 -->
            <div class="flex-1">
                <!-- 搜索区域 -->
                <div class="mb-6 bg-slate-800 rounded-lg p-4 shadow-md">
                    <div class="relative">
                        <input type="text" id="searchInput" placeholder="搜索日程内容、地点或类型..." 
                               class="w-full bg-slate-700 text-white px-4 py-2 rounded-md pl-10 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <i class="fa fa-search absolute left-3 top-3 text-slate-400"></i>
                    </div>
                </div>

                <!-- 日程列表 -->
                <div id="scheduleList" class="space-y-4">
                    <!-- 日程项将通过JavaScript动态生成 -->
                </div>

                <!-- 空状态提示 -->
                <div id="emptyState" class="text-center py-12 hidden">
                    <i class="fa fa-calendar-o text-5xl text-slate-600 mb-4"></i>
                    <h3 class="text-xl font-semibold text-slate-400 mb-2">暂无日程安排</h3>
                    <p class="text-slate-500 mb-6">点击"添加日程"按钮开始规划您的一周</p>
                    <button id="addFirstScheduleBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-md transition-colors">
                        <i class="fa fa-plus mr-2"></i>添加第一个日程
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加/编辑日程模态框 -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 id="modalTitle" class="text-xl font-bold">添加日程</h2>
                <button id="closeModalBtn" class="text-slate-400 hover:text-white">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <form id="scheduleForm">
                <input type="hidden" id="scheduleId">
                
                <div class="mb-4">
                    <label class="block text-slate-300 mb-2" for="date">日期</label>
                    <input type="date" id="date" required 
                           class="w-full bg-slate-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="mb-4">
                    <label class="block text-slate-300 mb-2" for="time">时间段</label>
                    <div class="flex items-center space-x-2">
                        <input type="time" id="startTime" required 
                               class="w-full bg-slate-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <span class="text-slate-400">至</span>
                        <input type="time" id="endTime" required 
                               class="w-full bg-slate-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-slate-300 mb-2" for="content">日程内容</label>
                    <textarea id="content" required rows="3" placeholder="请输入日程内容..."
                              class="w-full bg-slate-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="block text-slate-300 mb-2" for="location">地点</label>
                    <input type="text" id="location" placeholder="请输入地点（可选）"
                           class="w-full bg-slate-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="mb-4">
                    <label class="block text-slate-300 mb-2" for="type">类型</label>
                    <input type="text" id="type" required placeholder="请输入类型（如：会议、工作、学习等）"
                           class="w-full bg-slate-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <div class="mb-6">
                    <label class="block text-slate-300 mb-2" for="status">状态</label>
                    <select id="status" required 
                            class="w-full bg-slate-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="pending">未开始</option>
                        <option value="in-progress">进行中</option>
                        <option value="completed">已完成</option>
                    </select>
                </div>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancelBtn" class="bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded-md transition-colors">
                        取消
                    </button>
                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 日程详情模态框 -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 id="detailTitle" class="text-xl font-bold">日程详情</h2>
                <button id="closeDetailModalBtn" class="text-slate-400 hover:text-white">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="detailContent" class="space-y-4">
                <!-- 详情内容将通过JavaScript动态生成 -->
            </div>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button id="deleteBtn" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md transition-colors">
                    <i class="fa fa-trash mr-2"></i>删除
                </button>
                <button id="editBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors">
                    <i class="fa fa-edit mr-2"></i>编辑
                </button>
            </div>
        </div>
    </div>

    <!-- 导入模态框 -->
    <div id="importModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">导入日程</h2>
                <button id="closeImportModalBtn" class="text-slate-400 hover:text-white">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="mb-4">
                <p class="text-slate-300 mb-2">支持导入CSV格式的日程文件</p>
                <div id="fileImportArea" class="file-import-area">
                    <i class="fa fa-cloud-upload text-4xl text-slate-400 mb-2"></i>
                    <p class="text-slate-300">点击或拖拽文件到此处</p>
                    <p class="text-slate-500 text-sm mt-1">支持CSV格式</p>
                    <div id="fileName" class="text-blue-400 text-sm mt-2 hidden"></div>
                </div>
                <input type="file" id="fileInput" accept=".csv" class="hidden">
            </div>
            
            <div class="mb-4">
                <h3 class="text-slate-300 mb-2">CSV文件格式要求：</h3>
                <div class="bg-slate-700 p-3 rounded-md text-sm">
                    <p>日期,星期,时间,内容,地点,类型,状态,最后更新</p>
                    <p class="text-slate-400 mt-1">状态值: pending(未开始), in-progress(进行中), completed(已完成)</p>
                    <p class="text-slate-400 mt-1">注意：第一行必须是表头，数据从第二行开始</p>
                </div>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button id="cancelImportBtn" class="bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded-md transition-colors">
                    取消
                </button>
                <button id="confirmImportBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors" disabled>
                    <i class="fa fa-upload mr-2"></i>导入
                </button>
            </div>
        </div>
    </div>

    <!-- 通知区域 -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // 数据存储键名
        const STORAGE_KEY = 'fengsir-schedules';
        
        // 获取DOM元素
        const scheduleList = document.getElementById('scheduleList');
        const emptyState = document.getElementById('emptyState');
        const scheduleModal = document.getElementById('scheduleModal');
        const detailModal = document.getElementById('detailModal');
        const importModal = document.getElementById('importModal');
        const notification = document.getElementById('notification');
        const notificationText = document.getElementById('notificationText');
        const fileName = document.getElementById('fileName');
        
        // 当前筛选状态
        let currentFilterStatus = 'all';
        
        // 初始化应用
        document.addEventListener('DOMContentLoaded', function() {
            loadSchedules();
            setupEventListeners();
        });
        
        // 设置事件监听器
        function setupEventListeners() {
            // 添加日程按钮
            document.getElementById('addScheduleBtn').addEventListener('click', openAddModal);
            document.getElementById('addFirstScheduleBtn').addEventListener('click', openAddModal);
            
            // 模态框关闭按钮
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            document.getElementById('closeDetailModalBtn').addEventListener('click', closeDetailModal);
            document.getElementById('closeImportModalBtn').addEventListener('click', closeImportModal);
            document.getElementById('cancelBtn').addEventListener('click', closeModal);
            document.getElementById('cancelImportBtn').addEventListener('click', closeImportModal);
            
            // 表单提交
            document.getElementById('scheduleForm').addEventListener('submit', saveSchedule);
            
            // 状态筛选按钮
            document.querySelectorAll('.status-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // 更新按钮激活状态
                    document.querySelectorAll('.status-filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 更新筛选状态
                    currentFilterStatus = this.dataset.status;
                    
                    // 应用筛选
                    applyFilters();
                });
            });
            
            // 搜索输入
            document.getElementById('searchInput').addEventListener('input', function() {
                applyFilters();
            });
            
            // 导出按钮
            document.getElementById('exportBtn').addEventListener('click', exportToCSV);
            
            // 导入按钮
            document.getElementById('importBtn').addEventListener('click', openImportModal);
            document.getElementById('confirmImportBtn').addEventListener('click', importFromCSV);
            
            // 文件导入区域
            const fileImportArea = document.getElementById('fileImportArea');
            const fileInput = document.getElementById('fileInput');
            
            fileImportArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            
            // 拖放功能
            fileImportArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileImportArea.classList.add('dragover');
            });
            
            fileImportArea.addEventListener('dragleave', () => {
                fileImportArea.classList.remove('dragover');
            });
            
            fileImportArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileImportArea.classList.remove('dragover');
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelect();
                }
            });
            
            // 点击模态框外部关闭
            window.addEventListener('click', function(event) {
                if (event.target === scheduleModal) closeModal();
                if (event.target === detailModal) closeDetailModal();
                if (event.target === importModal) closeImportModal();
            });
        }
        
        // 处理文件选择
        function handleFileSelect() {
            const fileInput = document.getElementById('fileInput');
            const confirmBtn = document.getElementById('confirmImportBtn');
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                if (file.name.toLowerCase().endsWith('.csv')) {
                    fileName.textContent = `已选择文件: ${file.name}`;
                    fileName.classList.remove('hidden');
                    confirmBtn.disabled = false;
                } else {
                    fileName.textContent = '请选择CSV文件';
                    fileName.classList.remove('hidden');
                    confirmBtn.disabled = true;
                    showNotification('请选择CSV格式的文件', 'error');
                }
            } else {
                fileName.classList.add('hidden');
                confirmBtn.disabled = true;
            }
        }
        
        // 应用筛选
        function applyFilters() {
            const schedules = getSchedules();
            const keyword = document.getElementById('searchInput').value.toLowerCase();
            
            let filteredSchedules = schedules;
            
            // 状态筛选
            if (currentFilterStatus !== 'all') {
                filteredSchedules = filteredSchedules.filter(s => s.status === currentFilterStatus);
            }
            
            // 关键词搜索
            if (keyword) {
                filteredSchedules = filteredSchedules.filter(s => 
                    s.content.toLowerCase().includes(keyword) ||
                    (s.location && s.location.toLowerCase().includes(keyword)) ||
                    s.type.toLowerCase().includes(keyword)
                );
            }
            
            renderSchedules(filteredSchedules);
        }
        
        // 加载日程数据
        function loadSchedules() {
            applyFilters();
        }
        
        // 从localStorage获取日程数据
        function getSchedules() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : [];
        }
        
        // 保存日程数据到localStorage
        function saveSchedules(schedules) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(schedules));
        }
        
        // 渲染日程列表
        function renderSchedules(schedules) {
            scheduleList.innerHTML = '';
            
            if (schedules.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            // 按日期和时间排序（最新的排上面）
            schedules.sort((a, b) => {
                // 先按日期排序
                const dateCompare = new Date(b.date) - new Date(a.date);
                if (dateCompare !== 0) return dateCompare;
                
                // 日期相同则按开始时间排序
                const aStartTime = a.time.split(' - ')[0];
                const bStartTime = b.time.split(' - ')[0];
                return bStartTime.localeCompare(aStartTime);
            });
            
            schedules.forEach(schedule => {
                const scheduleItem = createScheduleItem(schedule);
                scheduleList.appendChild(scheduleItem);
            });
        }
        
        // 创建日程项DOM元素
        function createScheduleItem(schedule) {
            const item = document.createElement('div');
            item.className = `schedule-item fade-in schedule-type-${getTypeClass(schedule.type)}`;
            item.dataset.id = schedule.id;
            
            const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
            const date = new Date(schedule.date);
            const dayOfWeek = weekdays[date.getDay()];
            
            // 状态徽章
            const statusText = {
                'pending': '未开始',
                'in-progress': '进行中',
                'completed': '已完成'
            }[schedule.status] || '未开始';
            
            const statusClass = {
                'pending': 'status-pending',
                'in-progress': 'status-in-progress',
                'completed': 'status-completed'
            }[schedule.status] || 'status-pending';
            
            item.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h3 class="font-semibold text-lg mb-1">${schedule.content}</h3>
                        <div class="flex items-center text-slate-400 text-sm mb-2">
                            <i class="fa fa-clock-o mr-1"></i>
                            <span>${schedule.time}</span>
                            <i class="fa fa-map-marker ml-3 mr-1"></i>
                            <span>${schedule.location || '未设置地点'}</span>
                        </div>
                    </div>
                    <div class="text-right ml-4">
                        <span class="inline-block bg-slate-700 text-slate-300 px-2 py-1 rounded text-sm">${schedule.type}</span>
                        <div class="mt-2 text-slate-500 text-sm">${schedule.date} 周${dayOfWeek}</div>
                    </div>
                </div>
                <div class="status-badge ${statusClass}">${statusText}</div>
            `;
            
            item.addEventListener('click', () => openDetailModal(schedule.id));
            
            return item;
        }
        
        // 获取类型对应的CSS类名 - 基于类型名称生成
        function getTypeClass(type) {
            // 为不同类型生成不同的颜色类
            const typeColors = {
                '会议': 'custom-1',
                '工作': 'custom-2', 
                '学习': 'custom-3',
                '活动': 'custom-4',
                '健身': 'custom-5',
                '购物': 'custom-6',
                '旅行': 'custom-7',
                '家庭': 'custom-8'
            };
            
            // 如果类型在预定义列表中，返回对应的颜色类
            if (typeColors[type]) {
                return typeColors[type];
            }
            
            // 对于自定义类型，基于类型名称的哈希值生成颜色类
            let hash = 0;
            for (let i = 0; i < type.length; i++) {
                hash = type.charCodeAt(i) + ((hash << 5) - hash);
            }
            const colorIndex = Math.abs(hash) % 8 + 1; // 1-8之间的数字
            return `custom-${colorIndex}`;
        }
        
        // 打开添加日程模态框
        function openAddModal() {
            document.getElementById('modalTitle').textContent = '添加日程';
            document.getElementById('scheduleForm').reset();
            document.getElementById('scheduleId').value = '';
            
            // 设置默认日期为今天
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
            
            // 设置默认时间
            document.getElementById('startTime').value = '09:00';
            document.getElementById('endTime').value = '10:00';
            
            // 设置默认状态
            document.getElementById('status').value = 'pending';
            
            scheduleModal.style.display = 'flex';
        }
        
        // 打开编辑日程模态框
        function openEditModal(id) {
            const schedules = getSchedules();
            const schedule = schedules.find(s => s.id === id);
            
            if (!schedule) return;
            
            document.getElementById('modalTitle').textContent = '编辑日程';
            document.getElementById('scheduleId').value = schedule.id;
            document.getElementById('date').value = schedule.date;
            
            // 解析时间段
            const timeParts = schedule.time.split(' - ');
            document.getElementById('startTime').value = timeParts[0];
            document.getElementById('endTime').value = timeParts[1];
            
            document.getElementById('content').value = schedule.content;
            document.getElementById('location').value = schedule.location;
            document.getElementById('type').value = schedule.type;
            document.getElementById('status').value = schedule.status || 'pending';
            
            scheduleModal.style.display = 'flex';
        }
        
        // 关闭添加/编辑模态框
        function closeModal() {
            scheduleModal.style.display = 'none';
        }
        
        // 打开详情模态框
        function openDetailModal(id) {
            const schedules = getSchedules();
            const schedule = schedules.find(s => s.id === id);
            
            if (!schedule) return;
            
            document.getElementById('detailTitle').textContent = schedule.content;
            
            const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
            const date = new Date(schedule.date);
            const dayOfWeek = weekdays[date.getDay()];
            
            const statusText = {
                'pending': '未开始',
                'in-progress': '进行中',
                'completed': '已完成'
            }[schedule.status] || '未开始';
            
            document.getElementById('detailContent').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-slate-700 p-4 rounded-md">
                        <h3 class="font-semibold text-slate-300 mb-2">日期</h3>
                        <p>${schedule.date} 周${dayOfWeek}</p>
                    </div>
                    <div class="bg-slate-700 p-4 rounded-md">
                        <h3 class="font-semibold text-slate-300 mb-2">时间</h3>
                        <p>${schedule.time}</p>
                    </div>
                    <div class="bg-slate-700 p-4 rounded-md">
                        <h3 class="font-semibold text-slate-300 mb-2">类型</h3>
                        <p>${schedule.type}</p>
                    </div>
                    <div class="bg-slate-700 p-4 rounded-md">
                        <h3 class="font-semibold text-slate-300 mb-2">状态</h3>
                        <p>${statusText}</p>
                    </div>
                    <div class="bg-slate-700 p-4 rounded-md md:col-span-2">
                        <h3 class="font-semibold text-slate-300 mb-2">地点</h3>
                        <p>${schedule.location || '未设置地点'}</p>
                    </div>
                </div>
                <div class="bg-slate-700 p-4 rounded-md">
                    <h3 class="font-semibold text-slate-300 mb-2">内容</h3>
                    <p>${schedule.content}</p>
                </div>
                <div class="bg-slate-700 p-4 rounded-md">
                    <h3 class="font-semibold text-slate-300 mb-2">最后更新</h3>
                    <p>${schedule.updateTime}</p>
                </div>
            `;
            
            // 设置编辑和删除按钮的事件
            document.getElementById('editBtn').onclick = () => {
                closeDetailModal();
                openEditModal(id);
            };
            
            document.getElementById('deleteBtn').onclick = () => {
                if (confirm('确定要删除这个日程吗？')) {
                    deleteSchedule(id);
                    closeDetailModal();
                }
            };
            
            detailModal.style.display = 'flex';
        }
        
        // 关闭详情模态框
        function closeDetailModal() {
            detailModal.style.display = 'none';
        }
        
        // 打开导入模态框
        function openImportModal() {
            document.getElementById('fileInput').value = '';
            document.getElementById('confirmImportBtn').disabled = true;
            fileName.classList.add('hidden');
            importModal.style.display = 'flex';
        }
        
        // 关闭导入模态框
        function closeImportModal() {
            importModal.style.display = 'none';
        }
        
        // 保存日程（添加或编辑）
        function saveSchedule(e) {
            e.preventDefault();
            
            const id = document.getElementById('scheduleId').value;
            const date = document.getElementById('date').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const content = document.getElementById('content').value.trim();
            const location = document.getElementById('location').value.trim();
            const type = document.getElementById('type').value.trim();
            const status = document.getElementById('status').value;
            
            // 验证必填字段
            if (!content) {
                showNotification('请输入日程内容', 'error');
                return;
            }
            
            if (!type) {
                showNotification('请输入类型', 'error');
                return;
            }
            
            // 验证时间
            if (startTime >= endTime) {
                showNotification('结束时间必须晚于开始时间', 'error');
                return;
            }
            
            const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
            const dateObj = new Date(date);
            const dayOfWeek = weekdays[dateObj.getDay()];
            
            const schedule = {
                id: id || generateId(),
                date,
                day: `周${dayOfWeek}`,
                time: `${startTime} - ${endTime}`,
                content,
                location,
                type,
                status: status || 'pending',
                updateTime: new Date().toLocaleString('zh-CN')
            };
            
            const schedules = getSchedules();
            
            if (id) {
                // 编辑现有日程
                const index = schedules.findIndex(s => s.id === id);
                if (index !== -1) {
                    schedules[index] = schedule;
                    showNotification('日程已更新', 'success');
                }
            } else {
                // 添加新日程
                schedules.push(schedule);
                showNotification('日程已添加', 'success');
            }
            
            saveSchedules(schedules);
            loadSchedules();
            closeModal();
        }
        
        // 删除日程
        function deleteSchedule(id) {
            const schedules = getSchedules();
            const filteredSchedules = schedules.filter(s => s.id !== id);
            saveSchedules(filteredSchedules);
            loadSchedules();
            showNotification('日程已删除', 'success');
        }
        
        // 导出为CSV
        function exportToCSV() {
            const schedules = getSchedules();
            
            if (schedules.length === 0) {
                showNotification('没有可导出的日程', 'warning');
                return;
            }
            
            // CSV表头
            let csv = '日期,星期,时间,内容,地点,类型,状态,最后更新\n';
            
            // 添加数据行
            schedules.forEach(schedule => {
                csv += `"${schedule.date}","${schedule.day}","${schedule.time}","${schedule.content}","${schedule.location || ''}","${schedule.type}","${schedule.status}","${schedule.updateTime}"\n`;
            });
            
            // 创建下载链接
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `冯Sir周计划_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('日程已导出为CSV文件', 'success');
        }
        
        // 从CSV导入
        function importFromCSV() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showNotification('请选择要导入的文件', 'error');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const csvText = e.target.result;
                    const schedules = parseCSV(csvText);
                    
                    if (schedules.length === 0) {
                        showNotification('CSV文件中没有有效数据', 'error');
                        return;
                    }
                    
                    // 获取现有数据
                    const existingSchedules = getSchedules();
                    
                    // 创建ID映射以避免重复
                    const existingIds = new Set(existingSchedules.map(s => s.id));
                    
                    // 过滤掉重复ID的日程
                    const newSchedules = schedules.filter(schedule => !existingIds.has(schedule.id));
                    
                    if (newSchedules.length === 0) {
                        showNotification('没有新的日程可以导入（可能已存在相同ID的日程）', 'warning');
                        return;
                    }
                    
                    // 合并数据
                    const mergedSchedules = [...existingSchedules, ...newSchedules];
                    
                    saveSchedules(mergedSchedules);
                    loadSchedules();
                    closeImportModal();
                    showNotification(`成功导入 ${newSchedules.length} 个日程`, 'success');
                } catch (error) {
                    console.error('导入错误:', error);
                    showNotification('导入失败：文件格式不正确或文件损坏', 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('读取文件时发生错误', 'error');
            };
            
            reader.readAsText(file, 'UTF-8');
        }
        
        // 解析CSV数据
        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            
            if (lines.length < 2) {
                return [];
            }
            
            const headers = lines[0].split(',').map(header => header.trim().replace(/"/g, ''));
            const schedules = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                
                if (values.length < headers.length) {
                    console.warn(`跳过第 ${i+1} 行：数据列数不足`);
                    continue;
                }
                
                const schedule = {};
                
                for (let j = 0; j < headers.length; j++) {
                    if (j < values.length) {
                        schedule[headers[j]] = values[j].replace(/"/g, '').trim();
                    } else {
                        schedule[headers[j]] = '';
                    }
                }
                
                // 验证必要字段
                if (!schedule.日期 || !schedule.内容 || !schedule.类型) {
                    console.warn(`跳过第 ${i+1} 行：缺少必要字段`);
                    continue;
                }
                
                // 确保有ID
                if (!schedule.id) {
                    schedule.id = generateId();
                }
                
                // 确保有最后更新时间
                if (!schedule.最后更新) {
                    schedule.最后更新 = new Date().toLocaleString('zh-CN');
                }
                
                // 标准化字段名
                const normalizedSchedule = {
                    id: schedule.id || generateId(),
                    date: schedule.日期,
                    day: schedule.星期 || '周?',
                    time: schedule.时间 || '09:00 - 10:00',
                    content: schedule.内容,
                    location: schedule.地点 || '',
                    type: schedule.类型,
                    status: schedule.状态 || 'pending',
                    updateTime: schedule.最后更新 || new Date().toLocaleString('zh-CN')
                };
                
                schedules.push(normalizedSchedule);
            }
            
            return schedules;
        }
        
        // 解析CSV行（处理包含逗号的字段）
        function parseCSVLine(line) {
            const result = [];
            let inQuotes = false;
            let currentValue = '';
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(currentValue);
                    currentValue = '';
                } else {
                    currentValue += char;
                }
            }
            
            result.push(currentValue);
            return result.map(value => value.trim());
        }
        
        // 生成唯一ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }
        
        // 显示通知
        function showNotification(message, type = 'info') {
            notificationText.textContent = message;
            
            // 根据类型设置背景色
            if (type === 'success') {
                notification.style.backgroundColor = '#10b981';
            } else if (type === 'error') {
                notification.style.backgroundColor = '#ef4444';
            } else if (type === 'warning') {
                notification.style.backgroundColor = '#f59e0b';
            } else {
                notification.style.backgroundColor = '#3b82f6';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>